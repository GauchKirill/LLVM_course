# Gas Particle Simulation

Проект представляет собой симуляцию движения и столкновений частиц газа в замкнутом пространстве, реализованную на языке C с использованием библиотеки SDL2 для визуализации. Проект включает генератор LLVM IR и систему анализа трасс исполнения.

## О проекте

Программа моделирует поведение идеального газа в двумерном пространстве, где частицы:
- Двигаются с разными скоростями
- Имеют случайный размер
- Упруго сталкиваются со стенками контейнера
- Упруго сталкиваются друг с другом
- Имеют различные цвета для лучшей визуализации

## Архитектура проекта

Проект разделен на три основных модуля с четким разделением ответственности:

```
project/
├── pass/ # Исходные коды LLVM Pass
├── pass_build/ # Скомпилированные файлы Pass
├── src/ # Исходные файлы
│ ├── start.c # Точка входа (main)
│ ├── sim.c # Графический интерфейс (SDL2)
│ ├── app.c # Логика симуляции (чистые вычисления)
│ ├── logger.c # Функции логирования для инструментирования
│ └── app_ir_gen.cpp # Генератор LLVM IR для приложения
├── include/ # Заголовочные файлы
│ └── sim.h # Интерфейс между модулями
├── obj/ # Объектные файлы (генерируются)
├── bin/ # Исполняемые файлы (генерируются)
├── ir/ # LLVM IR файлы (генерируются)
├── analyze_trace.py # Анализатор трасс исполнения
├── trace.log # Собранная трасса (генерируется)
├── pattern_stats.txt # Статистика паттернов (генерируется)
└── Makefile # Система сборки
```


### Модули:

- **start.c** - минимальная точка входа, только вызов `run_app()`
- **sim.c** - вся работа с графикой (SDL2), отрисовка, обработка событий
- **app.c** - чистая логика симуляции, без зависимостей от графических библиотек
- **logger.c** - функции логирования для инструментированного кода
- **app_ir_gen.cpp** - генератор LLVM IR с пробросом графических функций
- **sim.h** - интерфейс между модулями

## Особенности проекта

### Генерация LLVM IR
Проект включает генератор LLVM IR (`app_ir_gen.cpp`), который:
- Создает LLVM IR код для логики симуляции
- Использует Execution Engine для интерпретации
- Пробрасывает графические функции (simInit, sim, simExit) через LazyFunctionCreator
- Позволяет выполнять симуляцию через LLVM без компиляции в машинный код

### Анализ трасс исполнения
Система инструментирования и анализа:
- LLVM Pass для логирования исполняемых инструкций
- Анализ паттернов выполнения (длиной 1-5 инструкций)
- Статистика наиболее частых последовательностей
- Визуализация горячих участков кода

## Требования

- Компилятор `clang` и `clang++`
- Библиотека `SDL2`
- `LLVM` (версия 18+)
- `Python 3` (для анализа трасс)
- Операционная система: Linux

## Установка и запуск

### 1. Клонирование и настройка
```bash
git clone <repository-url>
cd LLVM_course/SDL
```

### 2. Установка зависимостей
```bash
make install-deps
```

### 3. Проверка зависимостей
```bash
make check-deps
```

### 4. Сборка проекта
```bash
# Основная сборка
make

# Или с очисткой
make rebuild

# Информация о структуре проекта
make info
```

### 5. Запуск различных вариантов
```bash
# Обычный запуск (скомпилированная версия)
make run

# Запуск через LLVM IR генератор
make run_ir_gen

# Справка по командам
make help
```

## Инструментирование и анализ трасс
Проект включает систему для анализа производительности и паттернов выполнения кода

### 1. Сбор трассы исполнения
```bash
# Инструментирование кода app.c
make instrument

# Запуск инструментированной версии для сбора данных
make run-instrumented
```

### 2. Анализ паттернов
```bash
# Анализ собранной трассы
make analyze

# Просмотр результатов
cat pattern_stats.txt
```

## LLVM IR Генератор

### Запуск генератора
```bash
make run_ir_gen
```